<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seller Dashboard - BudgetSmart</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .tabs { display: flex; background: #f1f1f1; border-radius: 10px; overflow: hidden; margin-bottom: 30px; }
    .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; transition: 0.3s; }
    .tab.active { background: #007bff; color: white; }
    .tab:hover:not(.active) { background: #ddd; }
    .tab-content { display: none; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .tab-content.active { display: block; }
    .success { color:green; font-weight:bold; text-align:center; margin-top:15px; }
  </style>
</head>
  async function checkMyProducts() {
  const websiteInput = document.getElementById('website')?.value || 
                       document.getElementById('manualSellerName')?.value || 
                       prompt("Enter your store name or website to check:");
  
  if (!websiteInput) return;
  
  try {
    const res = await fetch(`/api/debug?seller=${encodeURIComponent(websiteInput.trim())}`);
    const items = await res.json();
    
    if (items.length === 0) {
      document.getElementById('myProductsList').innerHTML = 
        `<span style="color:orange;">No products found yet. If you just connected, wait 1–2 minutes and try again.</span>`;
    } else {
      document.getElementById('myProductsList').innerHTML = 
        `<span style="color:green;">Found ${items.length} products!</span><br>` +
        items.slice(0, 10).map(i => `• ${i.name} — ₦${i.price.toLocaleString()}`).join('<br>');
    }
  } catch (err) {
    document.getElementById('myProductsList').innerHTML = 
      '<span style="color:red;">Error checking — try again</span>';
  }
}
<body>
  <div class="container">
    <h1 style="text-align:center; margin-bottom:10px;">Seller Dashboard</h1>
    <p style="text-align:center; color:#666; margin-bottom:30px;">Choose how you want to add your products</p>

    <div class="tabs">
      <div class="tab active" onclick="openTab('website')">Add via Website</div>
      <div class="tab" onclick="openTab('manual')">Add via Image + Price</div>
    </div>

    <!-- TAB 1: Website Only -->
    <div id="website" class="tab-content active">
      <h2>Connect Your Online Store</h2>
      <p>We’ll automatically list your products later</p>
      <form id="websiteForm">
        <input type="text" name="sellerName" placeholder="Store / Seller Name" required/>
        <input type="text" name="website" id="website" placeholder="mchris.ng or https://yourstore.com" required/>
        <button type="submit" class="btn btn-primary">Connect Store</button>
      </form>
      <p id="msg1" class="success"></p>
    </div>

    <!-- TAB 2: Manual Upload -->
    <div id="manual" class="tab-content">
      <h2>Upload Item Manually</h2>
      <p>Add one item at a time with photo and price</p>
      <form id="manualForm" enctype="multipart/form-data">
         <input type="text" name="sellerName" id="manualSellerName" placeholder="Your Store / Name" required/>
        <input type="text" name="itemName" placeholder="Item Name (e.g. Wireless Earbuds)" required/>
        <input type="number" step="0.01" name="itemPrice" placeholder="Price ($)" required/>
        <input type="file" name="image" accept="image/*" required/>
        <button type="submit" class="btn btn-success">Add Item</button>
      </form>
      <p id="msg2" class="success"></p>
    </div>
  </div>
<div style="margin: 20px 0; text-align: center;">
  <button onclick="checkMyProducts()" class="btn btn-secondary">Check My Added Products</button>
  <div id="myProductsList" style="margin-top: 15px; color: green; font-weight: bold;"></div>
</div>
  <script>
    function openTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }

  // Form 1: Website Only — Accepts ANY domain (.ng, .com, etc.)
document.getElementById('websiteForm').onsubmit = async (e) => {
  e.preventDefault();
  
  const sellerName = document.getElementById('sellerName').value.trim(); // Assuming you add id="sellerName" to the input
  let website = document.getElementById('website').value.trim();

  // Clear any old messages
  document.getElementById('msg1').textContent = '';

  if (!sellerName || !website) {
    document.getElementById('msg1').innerHTML = '<span style="color:red;">Please fill both fields!</span>';
    return;
  }

  // Basic validation: Must have a dot (domain check)
  if (!website.includes('.')) {
    document.getElementById('msg1').innerHTML = '<span style="color:red;">Please enter a valid website (e.g., mchris.ng)</span>';
    return;
  }

  // Auto-fix URL to full format (adds https:// if missing)
  website = website.toLowerCase().replace(/^www\./, ''); // Remove leading www.
  if (!website.startsWith('http://') && !website.startsWith('https://')) {
    website = 'https://' + website;
  }
  // Remove trailing slash
  website = website.replace(/\/+$/, '');

  console.log('Submitting:', { sellerName, website }); // For debugging

  const formData = new FormData();
  formData.append('sellerName', sellerName);
  formData.append('website', website);
  formData.append('type', 'website');

  try {
    const res = await fetch('/api/seller', { method: 'POST', body: formData });
    const json = await res.json();
    document.getElementById('msg1').innerHTML = json.success 
      ? `<span style="color:green;">${json.message}</span>` 
      : `<span style="color:red;">${json.error || 'Try again'}</span>`;
    if (json.success) e.target.reset();
  } catch (err) {
    document.getElementById('msg1').innerHTML = '<span style="color:red;">Connection error — try again!</span>';
    console.error('Fetch error:', err);
  }
};
